<script>
    new Vue({
        el: "#app",
        data: {
            query: "", // For storing user input
            metrics: [],
        },
        methods: {
            async fetchData(city) {
                const apiKey = "fc21321e7e134d9e89b623c824bba1da";
                const response = await axios.get(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=fc21321e7e134d9e89b623c824bba1da`,
                    { validateStatus: () => true } // Disable automatic error throwing
                );

                // Now you can manually check if the request was successful
                if (response.status === 200) {
                    this.metrics = response.data;
                    console.log(response.data);
                } else {
                    alert("City not found. Please enter a valid city name.");
                    console.error("Error fetching weather:", response.status, response.data);
                }
            },
            searchWeather() {
                if (this.query.trim() !== "") {
                    this.fetchData(this.query.trim());
                }
            },
        },
        mounted() {
            this.fetchData("Nairobi"); // Default city
        },
        computed: {
            formattedLocalTime() {
                if (!this.metrics.dt || !this.metrics.timezone) return "Loading...";
                const localTimestamp = (this.metrics.dt + this.metrics.timezone) * 1000;
                const localDate = new Date(localTimestamp);

                return new Intl.DateTimeFormat("en-GB", {
                    weekday: "long",
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    hour: "2-digit",
                    minute: "2-digit",
                    hour12: true,
                }).format(localDate);
            },
        },
    });
</script>
